# 实施计划

- [x] 1. 搭建项目基础架构











  - 初始化Spring Boot 3.x后端项目，配置Maven/Gradle依赖
  - 初始化Vue 3 + Vite前端项目，配置必要的依赖�?
  - 配置PostgreSQL数据库连接和Redis连接
  - 设置项目目录结构和代码规范（ESLint、Prettier�?
  - _需求：所有需求的基础_

- [x] 2. 实现数据库模型和Repository�?


- [x] 2.1 创建数据库表结构



  - 编写SQL脚本创建users、system_logs、password_reset_tokens�?
  - 创建必要的索引以优化查询性能
  - _需求：1.1, 2.1, 6.1_

- [x] 2.2 实现Java实体�?
  - 创建User、SystemLog、PasswordResetToken实体�?
  - 配置JPA注解和关系映�?
  - 定义UserRole枚举类型
  - _需求：1.1, 4.1_

- [x] 2.3 实现Repository接口
  - 创建UserRepository、SystemLogRepository、PasswordResetTokenRepository
  - 实现自定义查询方法（按邮箱查询、按用户名查询等�?
  - _需求：1.3, 1.4, 6.3, 6.4, 6.5_

- [x] 2.4 编写Repository层单元测�?
  - 使用H2内存数据库测试Repository方法
  - 测试自定义查询的正确�?
  - _需求：1.3, 1.4_

- [-] 3. 实现核心安全组件


- [x] 3.1 实现密码加密服务


  - 配置BCryptPasswordEncoder
  - 实现密码加密和验证方�?
  - _需求：7.1, 7.2_


- [x] 3.2 编写属性测试：BCrypt密码加密






  - **属�?19: BCrypt密码加密**
  - **验证需求：7.1**

- [x] 3.3 编写属性测试：BCrypt密码验证






  - **属�?20: BCrypt密码验证**
  - **验证需求：7.2**

- [x] 3.4 实现JWT令牌服务





  - 创建TokenService接口和实现类
  - 实现JWT令牌生成方法（支持不同过期时间）
  - 实现JWT令牌验证和解析方�?
  - 实现令牌黑名单机制（使用Redis�?
  - _需求：2.3, 2.4, 8.1, 8.2, 8.3, 8.4_

- [x] 3.5 编写属性测试：JWT令牌结构完整�?






  - **属�?22: JWT令牌结构完整�?*
  - **验证需求：8.1**

- [x] 3.6 编写属性测试：JWT令牌验证正确�?






  - **属�?23: JWT令牌验证正确�?*
  - **验证需求：8.2, 8.3, 8.4**

- [x] 3.7 配置Spring Security





  - 配置JWT过滤�?
  - 配置权限控制规则
  - 配置CORS和CSRF保护
  - _需求：4.3, 4.4, 4.5_

- [x] 3.8 编写属性测试：权限控制正确�?






  - **属�?14: 权限控制正确�?*
  - **验证需求：4.3, 4.4**

- [-] 4. 实现邮件服务




- [x] 4.1 配置邮件发送服�?






  - 配置Spring Mail依赖和SMTP设置
  - 创建EmailService接口和实现类
  - 实现验证码邮件发送方�?
  - 实现密码重置邮件发送方�?
  - _需求：1.1, 1.2, 5.1_

- [x] 4.2 实现验证码生成和存储





  - 实现验证码生成逻辑�?位数字）
  - 使用Redis存储验证码（TTL 10分钟�?
  - _需求：1.5_

- [x] 4.3 编写单元测试：邮件服�?






  - 测试邮件发送功能（使用Mock�?
  - 测试验证码生成和存储
  - _需求：1.1, 5.1_

- [x] 5. 实现用户认证服务




- [x] 5.1 实现用户注册功能


  - 创建AuthService接口和实现类
  - 实现register方法（验证输入、创建用户、发送验证码�?
  - 实现密码复杂度验证逻辑
  - _需求：1.1, 1.2, 7.3, 7.4_

- [ ] 5.2 编写属性测试：注册成功创建用户



  - **属�?1: 注册成功创建用户**
  - **验证需求：1.1, 1.2**

- [ ]* 5.3 编写属性测试：邮箱和用户名唯一�?
  - **属�?2: 邮箱和用户名唯一�?*
  - **验证需求：1.3, 1.4**

- [ ]* 5.4 编写属性测试：密码复杂度验�?
  - **属�?21: 密码复杂度验�?*
  - **验证需求：7.3, 7.4**

- [x] 5.5 实现邮箱验证功能

  - 实现verifyEmail方法
  - 验证验证码的正确性和有效�?
  - 激活用户账�?
  - _需求：1.5_

- [ ]* 5.6 编写属性测试：验证码验证正确�?
  - **属�?3: 验证码验证正确�?*
  - **验证需求：1.5**

- [x] 5.7 实现用户登录功能

  - 实现login方法（验证凭证、生成JWT令牌�?
  - 支持用户名或邮箱登录
  - 记录登录日志
  - 更新最后登录时�?
  - _需求：2.1, 2.2, 2.5_

- [ ]* 5.8 编写属性测试：有效凭证登录成功
  - **属�?4: 有效凭证登录成功**
  - **验证需求：2.1**

- [ ]* 5.9 编写属性测试：错误密码登录失败
  - **属�?5: 错误密码登录失败**
  - **验证需求：2.2**

- [ ]* 5.10 编写属性测试：令牌过期时间正确�?
  - **属�?6: 令牌过期时间正确�?*
  - **验证需求：2.3, 2.4**

- [ ]* 5.11 编写属性测试：登录日志完整�?
  - **属�?7: 登录日志完整�?*
  - **验证需求：2.5, 6.1, 6.2**

- [x] 5.12 实现登出功能

  - 实现logout方法
  - 将JWT令牌加入黑名�?
  - _需求：2.1_

- [x] 5.13 实现令牌刷新功能

  - 实现refreshToken方法
  - 验证刷新令牌并生成新的访问令�?
  - _需求：8.5_

- [ ]* 5.14 编写属性测试：令牌刷新往返一致�?
  - **属�?24: 令牌刷新往返一致�?*
  - **验证需求：8.5**

- [-] 6. 实现密码重置功能



- [x] 6.1 实现密码重置请求


  - 实现requestPasswordReset方法
  - 生成重置令牌并存储到数据�?
  - 发送密码重置邮�?
  - _需求：5.1_

- [x] 6.2 实现密码重置执行







  - 实现resetPassword方法
  - 验证重置令牌的有效性和过期时间
  - 更新用户密码
  - 使所有现有JWT令牌失效
  - _需求：5.2, 5.3, 5.4, 5.5_

- [ ]* 6.3 编写属性测试：密码重置流程完整�?
  - **属�?16: 密码重置流程完整�?*
  - **验证需求：5.1, 5.2, 5.4**

- [ ]* 6.4 编写属性测试：密码重置令牌失效
  - **属�?17: 密码重置令牌失效**
  - **验证需求：5.5**

- [x] 7. 实现用户管理服务





- [x] 7.1 实现用户信息查询


  - 创建UserService接口和实现类
  - 实现getCurrentUser方法
  - 确保响应中不包含密码字段
  - _需求：3.5_

- [ ]* 7.2 编写属性测试：密码字段不可见�?
  - **属�?11: 密码字段不可见�?*
  - **验证需求：3.5, 7.5**

- [x] 7.3 实现个人信息更新

  - 实现updateUserInfo方法
  - 验证输入数据的有效�?
  - 更新数据库记�?
  - _需求：3.3_

- [ ]* 7.4 编写属性测试：个人信息更新一致�?
  - **属�?9: 个人信息更新一致�?*
  - **验证需求：3.3**

- [x] 7.5 实现头像上传功能

  - 实现uploadAvatar方法
  - 验证文件格式（JPG、PNG、GIF�?
  - 验证文件大小（最�?MB�?
  - 存储文件到MinIO或本地存�?
  - 更新用户头像URL
  - _需求：3.1, 3.2_

- [ ]* 7.6 编写属性测试：头像文件格式验证
  - **属�?8: 头像文件格式验证**
  - **验证需求：3.1**

- [x] 7.7 实现邮箱修改功能

  - 实现updateEmail方法
  - 发送验证码到新邮箱
  - 验证验证码后更新邮箱地址
  - _需求：3.4_

- [ ]* 7.8 编写属性测试：邮箱修改需要验�?
  - **属�?10: 邮箱修改需要验�?*
  - **验证需求：3.4**

- [x] 7.9 实现密码修改功能

  - 实现updatePassword方法
  - 验证原密码的正确�?
  - 更新为新密码
  - _需求：7.2_

- [x] 7.10 实现用户角色管理（管理员功能�?

  - 实现updateUserRole方法
  - 验证操作者为管理�?
  - 更新用户角色
  - _需求：4.2_

- [ ]* 7.11 编写属性测试：默认角色分配
  - **属�?12: 默认角色分配**
  - **验证需求：4.1**

- [ ]* 7.12 编写属性测试：角色修改立即生效
  - **属�?13: 角色修改立即生效**
  - **验证需求：4.2**

- [ ] 8. 实现系统日志服务




- [x] 8.1 实现日志记录功能


  - 创建SystemLogService
  - 实现登录日志记录方法
  - 实现操作日志记录方法
  - _需求：2.5, 6.1, 6.2_

- [x] 8.2 实现日志查询功能（管理员功能�?


  - 实现查询所有登录日志方法（支持分页和排序）
  - 实现按用户ID筛选日志方�?
  - 实现按时间范围筛选日志方�?
  - _需求：6.3, 6.4, 6.5_

- [ ]* 8.3 编写属性测试：日志查询排序和筛�?
  - **属�?18: 日志查询排序和筛�?*
  - **验证需求：6.3, 6.4, 6.5**

- [x] 9. 实现后端API控制�?


- [x] 9.1 实现AuthController


  - 创建POST /api/auth/register接口
  - 创建POST /api/auth/verify-email接口
  - 创建POST /api/auth/login接口
  - 创建POST /api/auth/logout接口
  - 创建POST /api/auth/refresh-token接口
  - 创建POST /api/auth/forgot-password接口
  - 创建POST /api/auth/reset-password接口
  - 添加请求验证注解
  - _需求：1.1, 1.2, 1.5, 2.1, 5.1, 8.5_

- [x] 9.2 实现UserController


  - 创建GET /api/users/me接口
  - 创建PUT /api/users/me接口
  - 创建POST /api/users/me/avatar接口
  - 创建PUT /api/users/me/email接口
  - 创建PUT /api/users/me/password接口
  - 创建GET /api/users/{id}接口（管理员�?
  - 创建PUT /api/users/{id}/role接口（管理员�?
  - _需求：3.1, 3.3, 3.4, 3.5, 4.2_

- [x] 9.3 实现SystemLogController










  - 创建GET /api/logs/login接口（管理员�?
  - 创建GET /api/logs/login/user/{userId}接口（管理员�?
  - _需求：6.3, 6.4, 6.5_

- [x] 9.4 实现全局异常处理�?
  - 创建GlobalExceptionHandler
  - 处理各种业务异常
  - 返回统一的错误响应格�?
  - _需求：所有需求_

- [ ]* 9.5 编写API集成测试
  - 测试完整的注�?验证-登录流程
  - 测试密码重置完整流程
  - 测试权限控制
  - _需求：1.1, 2.1, 5.1_

- [ ] 10. 实现前端认证页面
- [x] 10.1 创建登录页面


  - 创建LoginPage.vue组件
  - 实现登录表单和验证逻辑
  - 实现"记住登录"选项
  - 集成API调用
  - 处理登录成功和失败情�?
  - _需求：2.1, 2.2, 2.3, 2.4_

- [x] 10.2 创建注册页面


  - 创建RegisterPage.vue组件
  - 实现注册表单和验证逻辑
  - 实现密码强度提示
  - 集成API调用
  - _需求：1.1, 1.2, 7.3, 7.4_

- [x] 10.3 创建邮箱验证页面


  - 创建EmailVerificationPage.vue组件
  - 实现验证码输入界�?
  - 集成API调用
  - _需求：1.5_

- [x] 10.4 创建忘记密码页面


  - 创建ForgotPasswordPage.vue组件
  - 实现邮箱输入表单
  - 集成API调用
  - _需求：5.1_

- [x] 10.5 创建重置密码页面



  - 创建ResetPasswordPage.vue组件
  - 实现新密码输入表�?
  - 验证重置令牌
  - 集成API调用
  - _需求：5.2, 5.4_

- [x] 11. 实现前端用户管理页面




- [x] 11.1 创建个人中心页面

  - 创建ProfilePage.vue组件
  - 显示用户信息
  - 实现信息编辑功能
  - _需求：3.3, 3.5_

- [x] 11.2 创建头像上传组件


  - 创建AvatarUpload.vue组件
  - 实现图片预览功能
  - 实现文件上传逻辑
  - 验证文件格式和大�?
  - _需求：3.1, 3.2_

- [x] 11.3 创建密码修改表单


  - 创建PasswordChangeForm.vue组件
  - 实现原密码和新密码输�?
  - 实现密码强度提示
  - 集成API调用
  - _需求：7.2, 7.3, 7.4_

- [x] 11.4 创建邮箱修改表单


  - 创建EmailChangeForm.vue组件
  - 实现新邮箱输入和验证码验�?
  - 集成API调用
  - _需求：3.4_

- [x] 12. 实现前端路由和状态管�?




- [x] 12.1 配置Vue Router


  - 创建路由配置文件
  - 定义所有页面路�?
  - 实现路由守卫（JWT验证�?
  - 实现权限路由守卫
  - _需求：4.3, 4.4_

- [ ]* 12.2 编写属性测试：JWT令牌权限验证
  - **属�?15: JWT令牌权限验证**
  - **验证需求：4.5**

- [x] 12.3 配置Pinia状态管�?


  - 创建用户状态store
  - 实现登录状态管�?
  - 实现用户信息缓存
  - _需求：2.1_

- [x] 12.4 实现Axios拦截�?


  - 配置请求拦截器（添加JWT令牌�?
  - 配置响应拦截器（处理错误�?
  - 实现令牌自动刷新逻辑
  - _需求：8.5_

- [ ] 13. 实现前端管理员功能（可选）
- [ ] 13.1 创建用户管理页面
  - 显示用户列表
  - 实现用户角色修改功能
  - _需求：4.2_

- [ ] 13.2 创建日志查看页面
  - 显示登录日志列表
  - 实现日志筛选和排序功能
  - _需求：6.3, 6.4, 6.5_

- [ ] 14. 检查点 - 确保所有测试通过
- [x] 14.1 运行Repository层测试





  - 执行 `mvn test -Dtest=*Repository*`
  - 验证所有Repository测试通过
  
- [x] 14.2 运行Service层单元测试





  - 执行 `mvn test -Dtest=*ServiceTest`
  - 验证所有Service单元测试通过
  
- [ ] 14.3 运行属性测试（Property-Based Tests）




  - 执行 `mvn test -Dtest=*PropertyTest`
  - 验证所有属性测试通过
  - 如有失败，记录失败信息并询问用户
  
- [ ] 14.4 运行Security和Controller测试
  - 执行 `mvn test -Dtest=*Controller*,*Security*`
  - 验证所有API和安全测试通过
  
- [ ] 14.5 最终验证
  - 执行完整测试套件 `mvn clean test`
  - 确认所有测试通过
  - 如有问题请询问用户

- [x] 15. 完善文档和部署配�?




- [x] 15.1 编写API文档


  - 使用SpringDoc生成OpenAPI文档
  - 添加接口描述和示�?
  - _需求：所有需求_

- [x] 15.2 创建Docker配置


  - 编写后端Dockerfile
  - 编写前端Dockerfile
  - 创建docker-compose.yml
  - 配置PostgreSQL和Redis容器
  - _需求：所有需求_

- [x] 15.3 编写部署文档


  - 创建README.md
  - 编写环境配置说明
  - 编写部署步骤说明
  - _需求：所有需求_

- [ ]* 15.4 编写用户使用手册
  - 创建用户操作指南
  - 添加功能截图和说�?
  - _需求：所有需求_

- [ ] 16. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户
