  # 实施计划

- [x] 1. 扩展数据库模型







- [x] 1.1 创建文档和文件夹表结构



  - 编写SQL迁移脚本创建documents和folders表
  - 创建必要的索引优化查询性能
  - 添加外键约束确保数据完整性
  - _需求：1.1, 5.1_

- [x] 1.2 实现Java实体类


  - 创建Document和Folder实体类
  - 配置JPA注解和关系映射
  - 添加审计字段（创建时间、更新时间）
  - _需求：1.1, 5.1_

- [x] 1.3 实现Repository接口


  - 创建DocumentRepository和FolderRepository
  - 实现自定义查询方法（按用户查询、按文件夹查询、搜索等）
  - 添加分页和排序支持
  - _需求：2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 1.4 编写Repository层单元测试


  - 测试文档和文件夹的CRUD操作
  - 测试自定义查询方法
  - 测试级联删除和外键约束
  - _需求：1.1, 5.1_

- [x] 2. 实现文件存储服务



- [x] 2.1 实现FileStorageService接口


  - 创建FileStorageService接口和实现类
  - 实现文件存储方法（支持本地存储和MinIO）
  - 实现文件读取和删除方法
  - 实现唯一文件名生成逻辑
  - _需求：1.1, 10.1, 10.2_

- [x] 2.2 编写属性测试：文件名唯一性


  - **属性 26: 文件名唯一性**
  - **验证需求：10.1**

- [x] 2.3 编写属性测试：目录结构组织正确性


  - **属性 27: 目录结构组织正确性**
  - **验证需求：10.2**

- [x] 2.4 配置文件存储


  - 配置本地文件存储路径
  - 配置MinIO连接（可选）
  - 实现存储策略切换
  - _需求：1.1_

- [x] 2.5 编写FileStorageService单元测试


  - 测试文件存储和读取
  - 测试文件删除
  - 测试文件名生成
  - _需求：1.1, 10.1_

- [x] 3. 实现存储配额管理



- [x] 3.1 实现StorageQuotaService


  - 创建StorageQuotaService接口和实现类
  - 实现配额检查方法
  - 实现存储使用量更新方法
  - 实现存储信息查询方法
  - _需求：1.5, 8.1, 8.2, 8.3_

- [x] 3.2 编写属性测试：配额限制正确执行


  - **属性 3: 配额限制正确执行**
  - **验证需求：1.5**

- [x] 3.3 编写属性测试：存储空间计算准确性

  - **属性 21: 存储空间计算准确性**
  - **验证需求：8.1, 8.2**


- [x] 3.4 编写属性测试：存储空间信息完整性

  - **属性 22: 存储空间信息完整性**
  - **验证需求：8.3**


- [x] 3.5 更新用户统计表

  - 在user_statistics表中添加存储配额字段
  - 实现配额初始化逻辑
  - _需求：8.5_

- [x] 4. 实现文档上传功能
- [x] 4.1 实现DocumentService上传方法



  - 创建DocumentService接口和实现类
  - 实现单文件上传方法
  - 实现文件格式验证
  - 实现文件大小验证
  - 集成存储配额检查
  - _需求：1.1, 1.2, 1.3, 1.5_

- [x] 4.2 编写属性测试：有效格式文件上传成功


  - **属性 1: 有效格式文件上传成功**
  - **验证需求：1.1, 1.4**


- [x] 4.3 编写属性测试：无效格式文件被拒绝
  - **属性 2: 无效格式文件被拒绝**
  - **验证需求：1.3**


- [x] 4.4 实现批量上传功能

  - 实现批量上传方法
  - 实现错误隔离机制
  - 返回详细的批量操作结果
  - _需求：6.1, 6.2, 6.4_

- [x] 4.5 编写属性测试：批量上传结果完整性


  - **属性 17: 批量上传结果完整性**
  - **验证需求：6.4**

- [x] 4.6 编写属性测试：批量上传错误隔离


  - **属性 18: 批量上传错误隔离**
  - **验证需求：6.2**

- [x] 5. 实现文档查询功能



- [x] 5.1 实现文档列表查询



  - 实现分页查询方法
  - 实现排序功能
  - 实现文件名搜索
  - 实现文件类型筛选
  - 实现文件夹筛选
  - _需求：2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 5.2 编写属性测试：文档列表排序正确性


  - **属性 4: 文档列表排序正确性**
  - **验证需求：2.1**


- [x] 5.3 编写属性测试：分页功能正确性

  - **属性 5: 分页功能正确性**
  - **验证需求：2.2**


- [x] 5.4 编写属性测试：搜索功能正确性

  - **属性 6: 搜索功能正确性**
  - **验证需求：2.3**



- [x] 5.5 编写属性测试：文件类型筛选正确性

  - **属性 7: 文件类型筛选正确性**
  - **验证需求：2.4**

- [x] 5.6 编写属性测试：文件夹筛选正确性

  - **属性 8: 文件夹筛选正确性**
  - **验证需求：2.5**

- [x] 5.7 实现文档详情查询

  - 实现单个文档查询方法
  - 添加权限验证
  - _需求：9.1, 9.2_




- [x] 5.8 编写属性测试：文档访问权限验证

  - **属性 23: 文档访问权限验证**
  - **验证需求：9.1, 9.2**

- [ ] 6. 实现文档预览功能
- [x] 6.1 实现DocumentPreviewService


  - 创建DocumentPreviewService接口和实现类
  - 实现PDF预览方法
  - 实现TXT预览方法
  - 实现Word预览方法（转换或下载）
  - _需求：3.1, 3.2, 3.3_

- [x] 6.2 编写属性测试：文档预览权限验证


  - **属性 9: 文档预览权限验证**
  - **验证需求：3.4**

- [x] 6.3 实现预览错误处理





  - 处理文件不存在的情况
  - 处理文件损坏的情况
  - 处理转换失败的情况
  - _需求：3.5_

- [x] 6.4 编写预览功能单元测试





  - 测试PDF预览
  - 测试TXT预览
  - 测试Word预览
  - _需求：3.1, 3.2, 3.3_

- [x] 7. 实现文档基础操作




- [x] 7.1 实现文档重命名功能


  - 实现重命名方法
  - 验证文件内容不变
  - _需求：4.1_

- [x] 7.2 编写属性测试：重命名保持内容不变


  - **属性 10: 重命名保持内容不变**
  - **验证需求：4.1**

- [x] 7.3 实现文档移动功能

  - 实现移动到文件夹方法
  - 更新文件夹关联
  - _需求：4.2_

- [x] 7.4 编写属性测试：移动操作更新关联


  - **属性 11: 移动操作更新关联**
  - **验证需求：4.2**

- [x] 7.5 实现文档下载功能

  - 实现下载方法
  - 支持断点续传
  - _需求：4.3, 10.5_

- [x] 7.6 实现文档删除功能

  - 实现删除方法
  - 同时删除数据库记录和文件
  - 更新存储空间使用量
  - _需求：4.4, 4.5_

- [x] 7.7 编写属性测试：删除操作完整性


  - **属性 12: 删除操作完整性**
  - **验证需求：4.4**

- [x] 7.8 编写属性测试：删除更新存储空间

  - **属性 13: 删除更新存储空间**
  - **验证需求：4.5**

- [x] 7.9 实现批量删除功能

  - 实现批量删除方法
  - 实现权限验证
  - 返回详细的批量操作结果
  - _需求：7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 7.10 编写属性测试：批量删除结果完整性

  - **属性 19: 批量删除结果完整性**
  - **验证需求：7.4**

- [x] 7.11 编写属性测试：批量删除权限验证

  - **属性 20: 批量删除权限验证**
  - **验证需求：7.3**

- [x] 8. 实现文件夹管理功能




- [x] 8.1 实现FolderService


  - 创建FolderService接口和实现类
  - 实现文件夹创建方法
  - 实现文件夹列表查询
  - 实现文件夹详情查询
  - _需求：5.1_

- [x] 8.2 实现文件夹层级管理


  - 实现子文件夹创建
  - 实现文件夹路径计算
  - 支持多层级结构
  - _需求：5.2_

- [x] 8.3 编写属性测试：文件夹层级结构正确性


  - **属性 14: 文件夹层级结构正确性**
  - **验证需求：5.2**

- [x] 8.4 实现文件夹重命名

  - 实现重命名方法
  - 确保不影响文件夹中的文档
  - _需求：5.3_

- [x] 8.5 编写属性测试：文件夹重命名不影响文档

  - **属性 15: 文件夹重命名不影响文档**
  - **验证需求：5.3**

- [x] 8.6 实现文件夹删除

  - 实现删除空文件夹方法
  - 拒绝删除非空文件夹
  - _需求：5.4, 5.5_

- [x] 8.7 编写属性测试：非空文件夹删除被拒绝

  - **属性 16: 非空文件夹删除被拒绝**
  - **验证需求：5.5**

- [x] 8.8 编写FolderService单元测试


  - 测试文件夹CRUD操作
  - 测试层级结构
  - 测试删除限制
  - _需求：5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 9. 实现后端API控制器







- [x] 9.1 实现DocumentController

  - 创建POST /api/documents/upload接口
  - 创建POST /api/documents/batch-upload接口
  - 创建GET /api/documents接口（列表查询）
  - 创建GET /api/documents/{id}接口
  - 创建GET /api/documents/{id}/preview接口
  - 创建GET /api/documents/{id}/download接口
  - 创建PUT /api/documents/{id}接口
  - 创建DELETE /api/documents/{id}接口
  - 创建DELETE /api/documents/batch接口
  - 创建GET /api/documents/storage-info接口
  - 添加请求验证注解
  - _需求：1.1, 2.1, 3.1, 4.1, 4.3, 4.4, 6.1, 7.1, 8.3_


- [x] 9.2 实现FolderController

  - 创建POST /api/folders接口
  - 创建GET /api/folders接口
  - 创建GET /api/folders/{id}接口
  - 创建PUT /api/folders/{id}接口
  - 创建DELETE /api/folders/{id}接口
  - 创建GET /api/folders/{id}/documents接口
  - _需求：5.1, 5.2, 5.3, 5.4_

- [x] 9.3 实现文件上传配置


  - 配置MultipartResolver
  - 设置文件大小限制
  - 配置临时文件目录
  - _需求：1.2_

- [x] 9.4 实现全局异常处理


  - 处理文件上传异常
  - 处理文档不存在异常
  - 处理存储配额异常
  - 处理权限异常
  - _需求：所有需求_


- [x] 9.5 编写API集成测试

  - 测试完整的文档上传-下载-删除流程
  - 测试批量操作
  - 测试权限控制
  - 测试文件夹管理
  - _需求：1.1, 4.4, 5.1, 6.1, 7.1_

- [x] 10. 实现操作日志记录




- [x] 10.1 扩展SystemLogService


  - 添加文档操作日志记录方法
  - 记录敏感操作（删除、移动）
  - 记录操作前后状态
  - _需求：9.4, 9.5_

- [x] 10.2 编写属性测试：管理员访问权限


  - **属性 24: 管理员访问权限**
  - **验证需求：9.3**

- [x] 10.3 编写属性测试：操作日志记录完整性


  - **属性 25: 操作日志记录完整性**
  - **验证需求：9.5**

- [x] 10.4 实现日志查询接口（管理员）


  - 查询文档操作日志
  - 按用户筛选
  - 按操作类型筛选
  - _需求：9.3, 9.4_

- [x] 11. 实现前端文档管理页面





- [x] 11.1 创建文档列表页面


  - 创建DocumentListPage.vue组件
  - 实现文档列表展示
  - 实现分页功能
  - 实现搜索和筛选
  - _需求：2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 11.2 创建文档上传组件


  - 创建DocumentUpload.vue组件
  - 实现单文件上传
  - 实现批量上传
  - 实现上传进度显示
  - 实现文件格式和大小验证
  - _需求：1.1, 1.2, 1.3, 6.1_

- [x] 11.3 创建文档预览组件


  - 创建DocumentPreview.vue组件
  - 实现PDF预览
  - 实现TXT预览
  - 实现Word预览
  - _需求：3.1, 3.2, 3.3_

- [x] 11.4 创建文档卡片组件


  - 创建DocumentCard.vue组件
  - 显示文档信息
  - 实现操作菜单（重命名、移动、删除、下载）
  - _需求：4.1, 4.2, 4.3, 4.4_

- [x] 11.5 创建存储空间组件


  - 创建StorageQuota.vue组件
  - 显示存储使用情况
  - 显示配额警告
  - _需求：8.3, 8.4_

- [x] 12. 实现前端文件夹管理




- [x] 12.1 创建文件夹树组件


  - 创建FolderTree.vue组件
  - 实现树形结构展示
  - 实现文件夹展开/折叠
  - 实现文件夹选择
  - _需求：5.1, 5.2_

- [x] 12.2 创建文件夹操作组件


  - 实现创建文件夹对话框
  - 实现重命名文件夹对话框
  - 实现删除文件夹确认
  - _需求：5.1, 5.3, 5.4, 5.5_

- [x] 12.3 实现文件夹导航


  - 实现面包屑导航
  - 实现文件夹路径显示
  - 实现快速跳转
  - _需求：5.2_

- [x] 13. 实现前端状态管理





- [x] 13.1 创建文档状态store

  - 使用Pinia创建documentStore
  - 管理文档列表状态
  - 管理选中文档状态
  - 管理上传状态
  - _需求：1.1, 2.1_

- [x] 13.2 创建文件夹状态store

  - 使用Pinia创建folderStore
  - 管理文件夹树状态
  - 管理当前文件夹状态
  - _需求：5.1, 5.2_

- [x] 13.3 实现API客户端

  - 创建document API客户端
  - 创建folder API客户端
  - 实现请求拦截器
  - 实现响应拦截器
  - _需求：所有需求_

- [x] 14. 检查点 - 确保所有测试通过





  - 确保所有测试通过，如有问题请询问用户

- [x] 15. 性能优化和完善





- [x] 15.1 实现文件分块上传


  - 实现大文件分块上传
  - 实现断点续传
  - _需求：10.4, 10.5_

- [x] 15.2 实现缓存机制


  - 缓存文档列表
  - 缓存文件夹树
  - 使用Redis缓存
  - _需求：10.3_

- [x] 15.3 优化数据库查询


  - 添加必要的索引
  - 优化复杂查询
  - 实现查询结果缓存
  - _需求：10.3_

- [x] 15.4 实现文件压缩


  - 实现图片压缩（如果支持）
  - 实现文档压缩下载
  - _需求：性能优化_

- [x] 16. 编写文档和部署配置






- [x] 16.1 更新API文档

  - 添加文档管理接口文档
  - 添加文件夹管理接口文档
  - 添加请求示例
  - _需求：所有需求_


- [x] 16.2 更新部署文档

  - 添加文件存储配置说明
  - 添加MinIO配置说明（可选）
  - 更新环境变量说明
  - _需求：所有需求_

- [x] 16.3 编写用户使用指南


  - 创建文档管理使用指南
  - 添加功能截图
  - 添加常见问题解答
  - _需求：所有需求_

- [ ] 17. 最终检查点 - 确保所有测试通过




  - 确保所有测试通过，如有问题请询问用户
